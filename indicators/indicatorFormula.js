/*
 * hxc3.IndicatorFormula
 * @version: 1.0.9
 * last modified: 2020-4-19 11:04:57 AM
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.hxc3={})}(this,function(t){"use strict";function e(t,e){if(t){if(n=t,"[object String]"===m.call(n))t=parseFloat(t);else if(isNaN(parseFloat(t))){return(0).toFixed(e)}}else t=0;var n;return t.toFixed(e)}var n=function(t){return t.high},r=function(t){return t.low},o=function(t){return t.close},i=function(t){return t.open},u=function(t){return t.volume};var a={maxMinDataInRound:function(t,e,o,i){for(var u={},a=0;a<e.length;a++){var c,f,s,l,p=e[a],h="maxR"+p,y="minR"+p,d=0,g=1e6;if(o+1<p)break;if(null!==i[h]&&i[h])if(c=n(t[o]),f=r(t[o]),s=n(t[o-p]),l=r(t[o-p]),s==i[h]||i[y]==l)for(var v=0;v<p;v++)c=n(t[o-v]),f=r(t[o-v]),d=c>d?c:d,g=f<g?f:g;else d=c>i[h]?c:i[h],g=f<i[y]?f:i[y];else for(v=0;v<p;v++)c=n(t[o-v]),f=r(t[o-v]),d=c>d?c:d,g=f<g?f:g;u[h]=d,u[y]=g}return u},averageDataInRound:function(t,n,r,i){for(var u,a,c,f,s={},l=0;l<n.length&&(a="ma"+(c=n[l]),u=0,!(r+1<c));l++){if(null!==i[a]&&i[a])u=i[a]*c-o(t[r-c])+o(t[r]);else for(f=0;f<c;f++)u+=o(t[r-f]);s[a]=e(u/c,4)}return s},volStatusInRound:function(t,e,n,r){for(var i,a,c,f,s,l,p,h,y,d,g,v,b={},m=0;m<e.length&&(s=e[m],c="upVol"+e[m],f="downVol"+e[m],i=0,a=0,!(n<s));m++){if(null!==r[c]&&r[c])h=o(t[n])>o(t[n-1])||!1,p=o(t[n-s])>o(t[n-s-1])||!1,g=r[c],v=r[f],y=u(t[n]),d=u(t[n-s]),p&&h?(i=y+g-d,a=v):!p&&h?(i=y+g,a=v-d):p&&!h?(i=g-d,a=y+v):p||h||(i=g,a=y+v-d);else for(l=0;l<s;l++)o(t[n-l])>o(t[n-l-1])?i+=u(t[n-l]):a+=u(t[n-l]);b[c]=i,b[f]=a}return b}},c=function(t,e,n,r){for(var o=function(t,e){var n={},r=0,o=0;for(r=0;r<t.length;r++)for(o=0;o<e.length;o++)n[e[o]+t[r]]=NaN;return n}(e,r),i=[],u={},c=0;c<t.length;c++)u=a[n](t,e,c,i[c-1]),i[c]=A(u,o);return i},f=function(t,e,n){return t?e:n},s=function(t,e){return+t>+e?+t:+e},l=function(t){return Math.abs(+t)},p=function(t,e,n,r){return(n*t+(e-n)*r)/e},h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},v={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},b={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},m=Object.prototype.toString;function I(t){return"object"===(void 0===t?"undefined":h(t))&&"number"==typeof t.nodeType&&"object"===h(t.ownerDocument)}function j(t){return!!v[m.call(t)]}function x(t){return"[object Array]"===m.call(t)}function N(t){var e=void 0===t?"undefined":h(t);return"function"===e||!!t&&"object"===e}function O(t){if(null==t||"object"!==(void 0===t?"undefined":h(t)))return t;var e=t,n=m.call(t);if("[object Array]"===n){e=[];for(var r=0,o=t.length;r<o;r++)e[r]=O(t[r])}else if(b[n]){var i=t.constructor;if(t.constructor.from)e=i.from(t);else{e=new i(t.length);for(var u=0,a=t.length;u<a;u++)e[u]=O(t[u])}}else if(!v[n]&&!I(t))for(var c in e={},t)t.hasOwnProperty(c)&&(e[c]=O(t[c]));return e}function A(t,e,n){if(!N(e)||!N(t))return n?O(e):t;for(var r in e)if(e.hasOwnProperty(r)){var o=t[r],i=e[r];!N(i)||!N(o)||x(i)||x(o)||I(i)||I(o)||j(i)||j(o)?!n&&r in t||(t[r]=O(e[r])):A(o,i,n)}return t}var R,S,M=function(){function t(e){y(this,t);var n=e?O(e):{};this._option=A(n,this.constructor.defaultOption,!1)}return t.prototype.get=function(t){return t?this._option[t]:this._option},t}();function L(t){M.registerClass(t,t.type)}M.type="indicatorFormula",S={},(R=M).registerClass=function(t,e){return S[e]=t,t},R.getClass=function(t){return S[t]},R.hasClass=function(t){return!!S[t]},R.getAllClass=function(){return S};var w=function(t){function u(){return y(this,u),g(this,t.apply(this,arguments))}return d(u,t),u.prototype.calculate=function(t){for(var u,a,c,p,h,y,d,g,v,b,m,I,j,x,N,O,A,R=this.get("M1"),S=this.get("M2"),M=[],L=[],w=0,D=0,_=0,F=[],C=0,P=0;P<t.length;P++)if(c=t[P-1],y=t[P],w=0,D=0,C=0,c&&(p=o(c),j=i(c),I=r(c),v=n(y),b=r(y),d=o(y),g=i(y),h=l(v-p),m=l(b-p),x=l(v-I),N=l(p-j),A=f(m>x&&m>h,m+h/2+N/4,x+N/4),O=f(h>m&&h>x,h+m/2+N/4,A),C=16*(d-p+(d-g)/2+p-j)/O*s(h,m)),M.push(C),P<R)F.push({ASI:0,ASIT:0});else{for(u=0;u<R;u++)w+=M[P-u];if(L.push(w),P<R+S)F.push({ASI:w,ASIT:0});else{for(a=0;a<S;a++)D+=L[P-R-a];_=D/S,F.push({xIndex:t[P].day,ASI:+e(w,2),ASIT:+e(_,2)})}}return F},u}(M);w.type="asi",w.defaultOption={M1:26,M2:10},L(w,w.type);var D=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){for(var e=0,n=0,r=0,i={},u=[],a=[this.get("L1"),this.get("L4"),this.get("L5")],f="ma"+a[0],s="ma"+a[1],l="ma"+a[2],p=c(t,a,"averageDataInRound",["ma"]),h=0;h<p.length;h++)(i=p[h])[f]&&(e=(o(t[h])-i[f])/i[f]*100,i[s]&&(n=(o(t[h])-i[s])/i[s]*100,i[l]&&(r=(o(t[h])-i[l])/i[l]*100))),u.push({xIndex:t[h].day,BIAS:e,BIAS2:n,BIAS3:r});return u},e}(M);D.type="bias",D.defaultOption={L1:6,L4:12,L5:24},L(D,D.type);var _=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){var e,n,r,o,i,u,a,c=this.get("BOLL_N"),f=this.get("BOLL_P"),s=[],l=0;for(o=0;o<t.length;o++){if(l+=t[o].c,o>=c-1){for(e=l/c,a=0,i=o-(c-1);i<=o;i++)a+=(u=t[i].c-e)*u;n=e+f*(a=Math.sqrt(a/c)),r=e-f*a,l-=t[o-(c-1)].c}else e=n=r=0;s.push({xIndex:t[o].t,MID:e,UPPER:n,LOWER:r})}return s},e}(M);_.type="boll",_.defaultOption={BOLL_N:20,BOLL_P:2},L(_,_.type);var F=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){var e,n,r,o,i,u=this.get("N"),a=this.get("M1"),c=this.get("M2"),f=1/0,s=-1/0,l=0,p=0,h=[];for(o=0;o<t.length;o++){for(e=t[o].c,f=1/0,s=-1/0,i=o<u?0:o-u+1;i<=o;i++)f>t[i].i&&(f=t[i].i),s<t[i].a&&(s=t[i].a);n=(e-f)/(s-f)*100,(isNaN(n)||n===-1/0||n===1/0)&&(n=0),p=o<u?((l=(n+l*o)/(o+1))+p*o)/(o+1):((l=(n+(a-1)*l)/a)+(c-1)*p)/c,r=3*l-2*p,h.push({xIndex:t[o].t,K:l,D:p,J:r})}return h},e}(M);F.type="kdj",F.defaultOption={N:9,M1:3,M2:3},L(F,F.type);var C=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){var e,n,r,o,i,u,a=this.get("SHORT"),c=this.get("LONG"),f=this.get("M"),s=a-1,l=a+1,p=c-1,h=c+1,y=f-1,d=f+1,g=0,v=[];for(g=0;g<t.length;g++)e=t[g].close,0!=g&&e?o=2*((n=(i=(2*e+s*i)/l)-(u=(2*e+p*u)/h))-(r=(2*n+y*r)/d)):(r=n=(i=u=e||0)-u,o=0),v.push({xIndex:t[g].datetime,MACD:o,DIFF:n,DEA:r});return v},e}(M);C.type="macd",C.defaultOption={SHORT:12,LONG:26,M:9},L(C,C.type);var P=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){var e,n,r,o,i,u,a,c,f,h,y,d,g=this.get("N1"),v=this.get("N2"),b=this.get("N3"),m=[];for(d=0;d<t.length;d++){var I;e=t[d].close,0==d?(n=e,o=a=h=0,i=c=y=0):(n=t[d-1].close,o=p(s(e-n,0),g,1,o),i=p(l(e-n),g,1,i),a=p(s(e-n,0),v,1,a),c=p(l(e-n),v,1,c),h=p(s(e-n,0),b,1,h),y=p(l(e-n),b,1,y)),r=o/i*100||0,u=a/c*100||0,f=h/y*100||0,m.push(((I={xIndex:t[d].day})["RSI"+g]=r,I["RSI"+v]=u,I["RSI"+b]=f,I.A=20,I.D=80,I))}return m},e}(M);P.type="rsi",P.defaultOption={N1:6,N2:12,N3:24},L(P,P.type);var B=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){for(var e=this.get("M1"),n=this.get("M2"),r=this.get("M3"),o=[e],i="upVol"+o[0],u="downVol"+o[0],a=[],f=NaN,s=c(t,o,"volStatusInRound",["upVol","downVol"]),l=0;l<t.length;l++)s[l][i]&&(f=s[l][i]/s[l][u]*100),a.push({xIndex:t[l].t,VR:f||0,A:n,B:r});return a},e}(M);B.type="vr",B.defaultOption={M1:26,M2:100,M3:200},L(B,B.type);var E=function(t){function e(){return y(this,e),g(this,t.apply(this,arguments))}return d(e,t),e.prototype.calculate=function(t){for(var e=this.get("N"),n=this.get("N1"),r=this.get("N2"),i=this.get("N3"),u=[n,e],a="maxR"+u[0],f="minR"+u[0],s="maxR"+u[1],l="minR"+u[1],p=c(t,u,"maxMinDataInRound",["maxR","minR"]),h=[],y={},d=0,g=0,v=0;v<p.length;v++)(y=p[v])[a]&&(d=100*(y[a]-o(t[v]))/(y[a]-y[f])),y[s]&&(g=100*(y[s]-o(t[v]))/(y[s]-y[l])),h.push({xIndex:t[v].t,WR1:g,WR2:d,A:r,D:i});return h},e}(M);E.type="wr",E.defaultOption={N:10,N1:6,N2:20,N3:80},L(E,E.type),t.registerIndicatorFormula=L,t.IndicatorFormula=M,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=indicatorFormula.js.map
